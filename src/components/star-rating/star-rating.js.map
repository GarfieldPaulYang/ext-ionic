{"version":3,"sources":["star-rating.ts"],"names":[],"mappings":"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","file":"star-rating.js","sourceRoot":"","sourcesContent":["import { Component, OnInit, OnDestroy, Input, ElementRef } from '@angular/core';\nimport { ControlValueAccessor, NG_VALUE_ACCESSOR } from '@angular/forms';\nimport * as _ from 'lodash';\n\n\nexport class StarRatingCmp implements OnInit, OnDestroy, ControlValueAccessor {\n   max: number = 5;\n   readonly: boolean = false;\n\n  range: Array<number>;\n  private innerValue: number;\n  private hammer: HammerManager;\n  private onChangeCallback: (e: any) => void = () => { };\n\n  get value(): number {\n    return this.innerValue;\n  }\n\n  set value(v: number) {\n    if (v !== this.innerValue) {\n      this.innerValue = v;\n      this.fullStates();\n      this.onChangeCallback(v);\n    }\n  }\n\n  constructor(private elementRef: ElementRef) { }\n\n  ngOnInit() {\n    setTimeout(() => {\n      this.setupHammerHandlers();\n    });\n  }\n\n  ngOnDestroy() {\n    if (this.hammer) {\n      this.hammer.destroy();\n    }\n  }\n\n  setIcon(r: number): string {\n    if (r === 1) {\n      return 'star';\n    }\n\n    if (r === 2) {\n      return 'star-half';\n    }\n\n    return 'star-outline';\n  }\n\n  writeValue(val: any) {\n    if (_.isUndefined(val)) {\n      return;\n    }\n\n    if (val !== this.innerValue) {\n      this.innerValue = val;\n      this.fullStates();\n    }\n  }\n\n  registerOnChange(fn: any) {\n    this.onChangeCallback = fn;\n  }\n\n  registerOnTouched(fn: any) { }\n\n  setDisabledState(isDisabled: boolean) { }\n\n  rate(amount: number) {\n    if (this.readonly) {\n      return;\n    }\n\n    if (this.range[amount - 1] === 1) {\n      amount = amount - 1;\n    }\n\n    this.value = amount;\n  }\n\n  private setupHammerHandlers() {\n    let ratingEle: HTMLElement = this.elementRef.nativeElement.querySelector('.rating');\n\n    if (!ratingEle) return;\n\n    this.hammer = new Hammer(ratingEle, {\n      recognizers: [\n        [Hammer.Pan, { direction: Hammer.DIRECTION_HORIZONTAL }],\n      ]\n    });\n\n    this.hammer.on('panleft panright', _.throttle((e: any) => {\n      let closestEle: Element = document.elementFromPoint(e.center.x, e.center.y);\n      if (closestEle && ['LI'].indexOf(closestEle.tagName) > -1) {\n        this.rate(Number(closestEle.getAttribute('index')));\n      }\n    }, 50));\n  }\n\n  private fullStates(): void {\n    let states: Array<number> = [];\n    for (let i = 0; i < this.max; i++) {\n      if (this.value > i && this.value < i + 1) {\n        states[i] = 2;\n      } else if (this.value > i) {\n        states[i] = 1;\n      } else {\n        states[i] = 0;\n      }\n    }\n    this.range = states;\n  }\nstatic decorators: DecoratorInvocation[] = [\n{ type: Component, args: [{\n  selector: 'ion-star-rating',\n  template: `\n    <ul class=\"rating\">\n      <li *ngFor=\"let r of range; let i = index\" tappable (click)=\"rate(i + 1)\" attr.index=\"{{i + 1}}\">\n        <ion-icon [name]=\"setIcon(r)\"></ion-icon>\n      </li>\n    </ul>\n  `,\n  providers: [{ provide: NG_VALUE_ACCESSOR, useExisting: StarRatingCmp, multi: true }]\n}, ] },\n];\n/** @nocollapse */\nstatic ctorParameters: () => ({type: any, decorators?: DecoratorInvocation[]}|null)[] = () => [\n{type: ElementRef, },\n];\nstatic propDecorators: {[key: string]: DecoratorInvocation[]} = {\n'max': [{ type: Input },],\n'readonly': [{ type: Input },],\n};\n}\ninterface DecoratorInvocation {\n  type: Function;\n  args?: any[];\n}\n"]}